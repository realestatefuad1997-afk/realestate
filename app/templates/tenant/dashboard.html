{% extends 'base.html' %}
{% block title %}{{ _('Tenant Dashboard') }}{% endblock %}

{% block content %}

<style>
/* شبكة الكروت */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

/* كرت مستأجر */
.card-tenant {
  background-color: #fff;
  border-radius: 18px;
  padding: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  position: relative;
  cursor: pointer;
  transition: all 0.3s ease;
}
.card-tenant:hover {
  transform: translateY(-6px) scale(1.02);
  box-shadow: 0 15px 35px rgba(0,0,0,0.2);
}

/* أيقونات داخل دوائر */
.card-tenant .icon {
  font-size: 2rem;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 15px;
  right: 15px;
  color: #fff;
}
.icon-blue { background-color: #0d6efd; }
.icon-green { background-color: #198754; }
.icon-yellow { background-color: #ffc107; color: #212529; }
.icon-orange { background-color: #fd7e14; }
.icon-red { background-color: #dc3545; }

/* العناوين */
.card-tenant h6 {
  font-weight: 700;
  font-size: 1.1rem;
  margin-bottom: 6px;
}
.card-tenant .small-text {
  font-size: 0.85rem;
  color: #6c757d;
  margin-bottom: 4px;
}

/* شارات الحالة */
.badge-status {
  padding: 5px 10px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 600;
}

/* ألوان الحالات */
.bg-new { background: #0d6efd; color: #fff; }
.bg-in_progress { background: #ffc107; color: #212529; }
.bg-resolved { background: #198754; color: #fff; }
.bg-closed { background: #6c757d; color: #fff; }
.bg-active { background: #198754; color: #fff; }
.bg-pending { background: #ffc107; color: #212529; }
.bg-expired { background: #6c757d; color: #fff; }
.bg-paid { background: #198754; color: #fff; }
.bg-unpaid { background: #ffc107; color: #212529; }

/* عنوان رئيسي */
h3.dashboard-title {
  font-size: 1.8rem;
  font-weight: bold;
  margin-bottom: 20px;
}
</style>

<h3 class="dashboard-title">{{ _('Tenant Dashboard') }}</h3>

<!-- إجراءات سريعة -->
<div class="dashboard-grid mb-4">
  <a class="card-tenant text-decoration-none text-dark" href="{{ url_for('tenant.maintenance_create') }}">
    <i class="bi bi-tools icon-orange"></i>
    <h6>{{ _('New Maintenance Request') }}</h6>
    <div class="small-text">{{ _('Report an issue or request service') }}</div>
  </a>
  <a class="card-tenant text-decoration-none text-dark" href="{{ url_for('tenant.complaint_create') }}">
    <i class="bi bi-exclamation-triangle icon-red"></i>
    <h6>{{ _('New Complaint') }}</h6>
    <div class="small-text">{{ _('Submit a complaint to management') }}</div>
  </a>
</div>

<!-- عقودي ومدفوعاتي -->
<div class="dashboard-grid">
  {% for c in contracts %}
  <div class="card-tenant">
    <i class="bi bi-file-earmark-text icon-blue"></i>
    <h6>{{ _('Contract') }} #{{ c.id }}</h6>
    <div class="small-text">{{ c.property.title }}</div>
    <div class="small-text">{{ _('Start') }}: {{ c.start_date }} — {{ _('End') }}: {{ c.end_date }}</div>
    {% set status_class = {
        'active':'bg-active',
        'pending':'bg-pending',
        'expired':'bg-expired'
    }[c.status] %}
    <span class="badge-status {{ status_class }}">{{ c.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No contracts available') }}</div>
  {% endfor %}

  {% for p in payments %}
  <div class="card-tenant">
    <i class="bi bi-currency-dollar icon-green"></i>
    <h6>{{ _('Payment') }} #{{ p.id }}</h6>
    <div class="small-text">{{ _('Amount') }}: {{ p.amount }}</div>
    <div class="small-text">{{ _('Due') }}: {{ p.due_date }}</div>
    {% set pay_class = 'bg-paid' if p.status=='paid' else 'bg-unpaid' %}
    <span class="badge-status {{ pay_class }}">{{ p.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No payments available') }}</div>
  {% endfor %}
</div>

<!-- طلبات الصيانة والشكاوى -->
<h5 class="dashboard-title">{{ _('Maintenance & Complaints') }}</h5>
<div class="dashboard-grid">
  {% for m in maintenance_requests %}
  <div class="card-tenant" onclick="window.location.href='{{ url_for('tenant.maintenance_show', request_id=m.id) }}'">
    <i class="bi bi-tools icon-orange"></i>
    <h6>{{ m.title }}</h6>
    <div class="small-text">{{ m.description }}</div>
    {% if m.notes %}
    <div class="small-text text-primary">{{ _('Employee notes') }}: {{ m.notes }}</div>
    {% endif %}
    <div class="small-text"><i class="bi bi-clock"></i> {{ _('Created at') }}: {{ m.created_at }}</div>
    {% set m_class = {
      'new': 'bg-new',
      'in_progress': 'bg-in_progress',
      'resolved': 'bg-resolved',
      'closed': 'bg-closed'
    }[m.status] %}
    <span class="badge-status {{ m_class }}">{{ m.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No maintenance requests') }}</div>
  {% endfor %}

  {% for c in complaints %}
  <div class="card-tenant" onclick="window.location.href='{{ url_for('tenant.complaint_show', complaint_id=c.id) }}'">
    <i class="bi bi-exclamation-triangle icon-red"></i>
    <h6>{{ c.subject }}</h6>
    <div class="small-text">{{ c.description }}</div>
    {% if c.notes %}
    <div class="small-text text-primary">{{ _('Employee notes') }}: {{ c.notes }}</div>
    {% endif %}
    <div class="small-text"><i class="bi bi-clock"></i> {{ _('Created at') }}: {{ c.created_at }}</div>
    {% set c_class = {
      'new': 'bg-new',
      'reviewing': 'bg-in_progress',
      'resolved': 'bg-resolved',
      'closed': 'bg-closed'
    }[c.status] %}
    <span class="badge-status {{ c_class }}">{{ c.status }}</span>
  </div>
  {% else %}
  <div class="card-tenant">{{ _('No complaints') }}</div>
  {% endfor %}
</div>

{% endblock %}
